<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="details" page="True" name="Muskathlon page">
        <t t-call="website.publish_management">
            <t t-set="object" t-value="event"/>
            <t t-set="publish_edit" t-value="True"/>
        </t>
        <t t-call="website.layout">
            <div id="muskathlon_details">
                <!-- Include modal for registration -->
                <t t-call="muskathlon.modal_form"/>
                <t t-set="title">Muskathlon detail</t>
                <div id="wrap">
                    <!-- Just hold available disciplines for registration form -->
                    <div>
                        <ul id="available_disciplines" style="display: none;">
                            <t t-foreach="disciplines" t-as="discipline">
                                <li t-att-value="discipline" t-esc="discipline"/>
                            </t>
                        </ul>
                    </div>
                    <!-- States and country for registration form -->
                    <t t-call="muskathlon.states"/>

                    <!-- Event description -->
                    <div style="margin-left: 15px; margin-right: 15px;">
                        <div class="row event_details">
                            <t t-set="new_registration_url" t-value="'/muskathlon_registration/?event_id='+str(event.id)"/>
                            <div class="col-xs-12">
                                <div t-attf-style="background-image: url('/web/image/crm.event.compassion/{{ event.id }}/picture_1'); position: relative; left: -15px; background-size: cover; background-repeat: no-repeat; background-position: center center; height: 50vh; width: 100vw;">
                                    <div class="row" style="position: absolute; bottom: 0; left: 0; right: 0; background-color: #CD171E;">
                                        <center><h2 style="color: white; margin-top: 10px; margin-bottom: 10px;"><span class="text-uppercase" t-field="event.name"/></h2></center>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-1 col-md-2"/>
                                    <div class="col-sm-10 col-md-8">
                                        <div style="margin-left: auto; margin-right: auto; max-width: 1200px; float: none;">
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <h1>About this event</h1>
                                                </div>
                                                <div class="col-sm-6">
                                                    <p style="margin-bottom: 20px;" t-field="event.public_description"/>
                                                </div>
                                                <div class="col-sm-6" style="font-size: 16px; font-weight: bold;">
                                                    <span class="text-uppercase" style="display: inline-block; width: 95px;">Dates</span>
                                                    <span style="white-space: nowrap;">
                                                        <t t-esc="time.strftime('%d %B %Y',time.strptime(event.start_date,'%Y-%m-%d %H:%M:%S'))"/> - <t t-esc="time.strftime('%d %B %Y',time.strptime(event.end_date,'%Y-%m-%d %H:%M:%S'))"/>
                                                    </span>
                                                    <div style="height: 20px"/>
                                                    <p class="text-uppercase">Sports</p>
                                                    <table class="sports_icons">
                                                        <tr>
                                                            <t t-foreach="event.sport_discipline_ids" t-as="discipline">
                                                            <span style="background-color: rgba(255, 255, 255, 0.7); height: 40px; width: 40px; margin-top: -8px; padding-top: 3px;">
                                                                <t t-if="'Biking' == discipline.sport">
                                                                    <td align="center">
                                                                        <img style="height: 34px; "
                                                                             src="/muskathlon/static/src/data/biking.png"/>
                                                                        <br/><span class="distance_km"><t t-esc="discipline.distance_km"/>km</span>
                                                                    </td>
                                                                </t>
                                                                <t t-if="'Climbing' == discipline.sport">
                                                                    <td align="center">
                                                                        <img style="height: 34px; "
                                                                             src="/muskathlon/static/src/data/climbing.png"/>
                                                                        <br/><span class="distance_km"><t t-esc="discipline.distance_km"/>km</span>
                                                                    </td>
                                                                </t>
                                                                <t t-if="'Running' == discipline.sport">
                                                                    <td align="center">
                                                                        <img style="height: 34px; "
                                                                             src="/muskathlon/static/src/data/running.png"/>
                                                                        <br/><span class="distance_km"><t t-esc="discipline.distance_km"/>km</span>
                                                                    </td>
                                                                </t>
                                                                <t t-if="'Walking' == discipline.sport">
                                                                    <td align="center">
                                                                        <img style="height: 38px; "
                                                                             src="/muskathlon/static/src/data/walking.png"/>
                                                                        <br/><span class="distance_km"><t t-esc="discipline.distance_km"/>km</span>
                                                                    </td>
                                                                </t>
                                                            </span>
                                                        </t>
                                                        </tr>
                                                    </table>
                                                    <p style="margin-top: 16px;">
                                                        <a href="#" data-toggle="modal" data-target="#modal_muskathlon_registration" class="btn btn-danger" style="background-color: #CD171E;">
                                                            <span style="text-align: center;">Register</span>
                                                        </a>
                                                    </p>
                                                </div>
                                                <div class="col-xs-12">
                                                    <p class="text-uppercase" style="font-weight: bold; margin-top: 20px;">Total des donations pour ce projet :</p>
                                                    <div class="progress" style="height: 20px;">
                                                        <div class="progress-bar" role="progressbar"
                                                             t-attf-aria-valuenow="{{ event.amount_raised_percents }}"
                                                             aria-valuemin="0"
                                                             aria-valuemax="100"
                                                             t-attf-style="width: {{ event.amount_raised_percents }}%; background-color: #e6b414;">
                                                        </div>
                                                        <div style="text-align: right;">
                                                            <t t-esc="'{:n}'.format(event.amount_raised)"/> / <t t-esc="'{:n}'.format(event.amount_objective)"/> CHF
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-1 col-md-2"/>
                                </div>
                            </div>
                        </div>
                        <div class="row participants_container">
                            <div class="col-md-1"/>
                            <div class="col-md-10">
                                <t t-if="event.muskathlon_registration_ids.filtered('website_published')">
                                    <h1 style="text-align: center; color: white; margin-top: 30px; margin-bottom: 20px;">Participants</h1>
                                </t>
                                <t t-else="">
                                    <h3 style="text-align: center; color: white; margin-top: 30px; margin-bottom: 20px;">This muskathlon has no participant yet.</h3>
                                </t>
                                <div class="participants">
                                    <t t-foreach="event.muskathlon_registration_ids.filtered('website_published')" t-as="registration">
                                        <div class="participant_card">
                                            <a t-att-href="registration.website_url">
                                                <div t-attf-style="background-image: url('/web/image/muskathlon.registration/{{ registration.id }}/ambassador_picture_1'); width: 100%; height: 175px; position: relative; background-size: cover; background-repeat: no-repeat; background-position: center center;">
                                                    <t t-call="muskathlon.sport_icon"/>
                                                </div>
                                            </a>
                                            <a t-att-href="registration.website_url">
                                                <div style="position: relative; padding: 10px;">
                                                    <h4 class="name"><t t-esc="registration.partner_display_name"/></h4>
                                                    <div class="progress">
                                                        <div class="progress-bar" role="progressbar"
                                                             t-attf-aria-valuenow="{{ registration.amount_raised_percents }}"
                                                             aria-valuemin="0"
                                                             aria-valuemax="100"
                                                             t-attf-style="width: {{ registration.amount_raised_percents }}%; background-color: #e6b414;">
                                                        </div>
                                                    </div>
                                                    <div class="amount_raised">
                                                        <t t-esc="'{:n}'.format(registration.amount_raised)"/> / <t t-esc="'{:n}'.format(registration.amount_objective)"/> CHF
                                                    </div>
                                                    <h5 class="text-uppercase name details" style="color:white;"><span class="details_text">Participant<br/>details</span></h5>
                                                </div>
                                            </a>
                                        </div>
                                    </t>
                                </div>
                            </div>
                            <div class="col-md-1"/>
                            <div style="height: 50px; background-color: #CD171E; z-index:1"/>
                        </div>
                        <div class="oe_structure"/>
                        <!-- animation for participants details button -->
                        <script>
                            $('.participant_card a').hover(function() {
                                $(this).find('.details').css('animation-name', 'show_details_button').css('animation-fill-mode', 'forwards');
                            }, function() {
                                $(this).find('.details').css('animation-name', 'hide_details_button').css('animation-fill-mode', 'forwards');
                            });
                        </script>
                    </div>
                    <div>
                        <t t-call="muskathlon.footer_muskathlon"/>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
